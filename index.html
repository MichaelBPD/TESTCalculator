<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gutter Quote Calculator</title>
  <style>
    :root{
      --brand:#ec008c;
      --bg:#ffe100;
      --card:#fff;
      --text:#222;
      --muted:#666;
      --blue:#007bff;
      --red:#dc2626;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:var(--text)}
    header{padding:22px 16px;text-align:center}
    h1{margin:0 0 6px;color:var(--brand)}
    p{margin:0;color:var(--muted)}

    .wrap{max-width:980px;margin:16px auto;padding:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--card);border-radius:18px;box-shadow:0 2px 10px rgba(0,0,0,.12);padding:16px}
    fieldset{border:1px solid #eee;border-radius:12px;padding:12px;margin:0 0 12px}
    legend{padding:0 8px;color:#555}
    label{display:block;font-weight:700;margin:10px 0 6px}
    input[type="number"], input[type="password"], select{
      width:100%;padding:10px;border:1px solid #ccc;border-radius:10px;font-size:15px
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .inline{display:flex;align-items:center;gap:10px;margin-top:8px}
    .muted{font-size:12px;color:var(--muted)}
    .summary h2{margin:0 0 6px;color:var(--brand);text-align:center}
    .pill{display:inline-block;background:#f4f4f4;border-radius:999px;padding:7px 12px;margin:6px 6px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    .right{text-align:right}

    /* Lock screen */
    .lock-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .lock-card{
      width:min(520px, 100%);
      background:#fff;border-radius:22px;box-shadow:0 2px 12px rgba(0,0,0,.15);
      padding:18px;
      text-align:center;
    }
    .lock-top{
      display:flex;align-items:center;justify-content:center;gap:14px;flex-wrap:wrap;
      margin-bottom:10px;
    }
    .lock-logo{max-height:56px;max-width:180px}
    .btn{
      width:100%;border:0;border-radius:12px;padding:12px 14px;
      background:var(--blue);color:#fff;font-size:16px;font-weight:700;cursor:pointer
    }
    .btn:hover{background:#0056b3}
    .err{color:var(--red);font-weight:700;margin-top:10px;display:none}
  </style>
</head>

<body>
  <!-- ===================== LOCK SCREEN ===================== -->
  <div id="lockScreen" class="lock-wrap">
    <div class="lock-card">
      <div class="lock-top">
        <img class="lock-logo" src="Logo.png" alt="Logo" />
        <div>
          <h2 style="margin:0;color:var(--brand)">Restricted Access</h2>
          <div class="muted" style="margin-top:6px">Enter passcode to load the calculator</div>
        </div>
      </div>

      <label for="passcode" style="text-align:left;margin-top:12px">Passcode</label>
      <input id="passcode" type="password" placeholder="Enter passcode" autocomplete="current-password" />

      <div class="inline" style="justify-content:flex-start">
        <input id="remember" type="checkbox" />
        <label for="remember" style="margin:0;font-weight:700">Remember for this browser (7 days)</label>
      </div>

      <button id="unlockBtn" class="btn" type="button">Unlock</button>
      <div id="lockError" class="err">Incorrect passcode.</div>
    </div>
  </div>

  <!-- ===================== APP (HIDDEN UNTIL UNLOCK) ===================== -->
  <div id="app" style="display:none;">
    <header>
      <h1>Quote Calculator</h1>
      <p>All prices include labour, materials and markups unless specified otherwise</p>
    </header>

    <div class="wrap">
      <div class="grid">
        <div class="card">

          <fieldset>
            <legend>Job basics</legend>
            <div class="row">
              <div>
                <label for="storeys">Storey</label>
                <select id="storeys">
                  <option value="single" selected>Single story</option>
                  <option value="double">Double story</option>
                </select>
              </div>
              <div>
                <label for="twoDay">Job length</label>
                <select id="twoDay">
                  <option value="no" selected>Standard</option>
                  <option value="yes">2 Day likely job</option>
                </select>
              </div>
            </div>

            <label for="accessAllowance">Difficult access allowance ($)</label>
            <input type="number" id="accessAllowance" value="0" min="0" step="1" />
          </fieldset>

          <fieldset>
            <legend>Gutters</legend>

            <label for="lengthM">Gutter length (metres)</label>
            <input type="number" id="lengthM" value="0" min="0" step="1" />
            <div class="muted">Whole metres only</div>

            <div class="row">
              <div>
                <label for="corners">Corners</label>
                <input type="number" id="corners" value="0" min="0" step="1" />
              </div>
              <div>
                <label for="rakes">Rakes</label>
                <input type="number" id="rakes" value="0" min="0" step="1" />
              </div>
            </div>

            <label for="guardsLengthM">Gutter guard length (metres)</label>
            <input type="number" id="guardsLengthM" value="0" min="0" step="10" />
            <div class="muted">Charged per 10 metres (rounded to nearest 10m)</div>
          </fieldset>

          <fieldset>
            <legend>Downpipes</legend>
            <div class="row">
              <div>
                <label for="downpipeType">Type</label>
                <select id="downpipeType">
                  <option value="pvc">PVC</option>
                  <option value="metal">Metal</option>
                </select>
              </div>
              <div>
                <label for="downpipes">Quantity</label>
                <input type="number" id="downpipes" value="0" min="0" step="1" />
              </div>
            </div>
          </fieldset>

          <fieldset>
            <legend>Access equipment</legend>
            <div class="inline">
              <input type="checkbox" id="scaffolding" />
              <label for="scaffolding" style="margin:0">Scaffolding</label>
            </div>

            <div class="inline" style="margin-left:20px">
              <input type="checkbox" id="difficultScaffolding" />
              <label for="difficultScaffolding" style="margin:0">Difficult scaffolding (x1.5)</label>
            </div>

            <div class="inline">
              <input type="checkbox" id="boom" />
              <label for="boom" style="margin:0">Boom lift</label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Options</legend>
            <div class="inline">
              <input type="checkbox" id="tileRoof" />
              <label for="tileRoof" style="margin:0">Tile roof (x1.25 gutters, corners, rakes & gutter guard)</label>
            </div>
          </fieldset>

          <fieldset>
            <legend>GST</legend>
            <div class="inline">
              <input type="checkbox" id="excludeGST" />
              <label for="excludeGST" style="margin:0">Exclude GST (ex GST)</label>
            </div>
            <div class="muted">All values will be divided by 1.1.</div>
          </fieldset>

          <div class="muted">Tip: change values and it will auto-recalculate.</div>
        </div>

        <div class="card summary">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
            <h2 style="margin:0">Estimate</h2>
            <img src="Logo.png" alt="Logo" style="max-height:48px" />
          </div>
          <div id="topPills" style="text-align:center"></div>
          <table id="breakdown" aria-label="Breakdown"></table>
        </div>
      </div>
    </div>
  </div>

  <script>
    /***************
     * PASSCODE GATE
     ***************/
    const CORRECT_PASSCODE = "8008"; // change this
    const UNLOCK_KEY = "gutter_calc_unlock_until";

    function nowMs(){ return Date.now(); }

    function isUnlocked(){
      const until = Number(localStorage.getItem(UNLOCK_KEY) || "0");
      return until > nowMs();
    }

    function showApp(){
      document.getElementById("lockScreen").style.display = "none";
      document.getElementById("app").style.display = "block";
      initCalculator(); // only initialize after unlock
    }

    function tryUnlock(){
      const entered = document.getElementById("passcode").value;
      const remember = document.getElementById("remember").checked;
      const err = document.getElementById("lockError");

      if(entered === CORRECT_PASSCODE){
        err.style.display = "none";
        if(remember){
          // 7 days
          localStorage.setItem(UNLOCK_KEY, String(nowMs() + 7*24*60*60*1000));
        } else {
          // session-only (expires when tab closes)
          sessionStorage.setItem("gutter_calc_unlocked", "1");
        }
        showApp();
      } else {
        err.style.display = "block";
      }
    }

    // auto-unlock rules:
    if (isUnlocked() || sessionStorage.getItem("gutter_calc_unlocked") === "1") {
      showApp();
    } else {
      document.getElementById("unlockBtn").addEventListener("click", tryUnlock);
      document.getElementById("passcode").addEventListener("keydown", (e)=> {
        if(e.key === "Enter") tryUnlock();
      });
    }

    /*********************
     * CALCULATOR (ONLY RUNS AFTER UNLOCK)
     *********************/
    function money(n){
      return Number(n||0).toLocaleString("en-AU",{style:"currency",currency:"AUD"});
    }
    function roundTo10(n){
      return Math.round(n / 10) * 10;
    }

    const PRICING = {
      guttersPerM: { single: 300, double: 350 },
      cornerEach: 250,
      rakeEach: 350,
      guardPer10M: { single: 1250, double: 1500 },
      downpipeEach: {
        pvc: { single: 450, double: 650 },
        metal: { single: 650, double: 850 }
      },
      scaffoldingDefault: 4000,
      difficultScaffoldingMultiplier: 1.5,
      boomTravel: 1200,
      boomPerDay: 300,
      tileMultiplier: 1.25,
      secondDaySetup: 500,
      gstDivisor: 1.1
    };

    function initCalculator(){
      const els = {
        storeys: document.getElementById("storeys"),
        twoDay: document.getElementById("twoDay"),
        accessAllowance: document.getElementById("accessAllowance"),
        lengthM: document.getElementById("lengthM"),
        corners: document.getElementById("corners"),
        rakes: document.getElementById("rakes"),
        guardsLengthM: document.getElementById("guardsLengthM"),
        downpipeType: document.getElementById("downpipeType"),
        downpipes: document.getElementById("downpipes"),
        scaffolding: document.getElementById("scaffolding"),
        difficultScaffolding: document.getElementById("difficultScaffolding"),
        boom: document.getElementById("boom"),
        tileRoof: document.getElementById("tileRoof"),
        excludeGST: document.getElementById("excludeGST"),
        topPills: document.getElementById("topPills"),
        breakdown: document.getElementById("breakdown"),
      };

      function calc(){
        const storeys = els.storeys.value;
        const twoDay = els.twoDay.value === "yes";
        const tileRoof = els.tileRoof.checked;
        const excludeGST = els.excludeGST.checked;

        const gstFactor = excludeGST ? 1 / PRICING.gstDivisor : 1;
        const tileFactor = tileRoof ? PRICING.tileMultiplier : 1;

        // force guard length to nearest 10m
        const guardsM = roundTo10(Math.max(0, Number(els.guardsLengthM.value || 0)));
        els.guardsLengthM.value = guardsM;

        const lengthM = Math.max(0, Math.round(Number(els.lengthM.value || 0))); // whole metres
        els.lengthM.value = lengthM;

        const corners = Math.max(0, Math.round(Number(els.corners.value || 0)));
        const rakes = Math.max(0, Math.round(Number(els.rakes.value || 0)));
        const downpipes = Math.max(0, Math.round(Number(els.downpipes.value || 0)));

        const accessAllowance = Math.max(0, Number(els.accessAllowance.value || 0));

        const lines = [];
        const add = (label, costIncGST) => {
          const cost = costIncGST * gstFactor;
          if(cost > 0) lines.push({label, cost});
        };

        // Tile roof affects gutters + corners + rakes + gutter guard
        add("Gutters", (lengthM * PRICING.guttersPerM[storeys]) * tileFactor);
        add("Corners", (corners * PRICING.cornerEach) * tileFactor);
        add("Rakes", (rakes * PRICING.rakeEach) * tileFactor);

        const guardBlocks = guardsM / 10;
        add("Gutter guard", (guardBlocks * PRICING.guardPer10M[storeys]) * tileFactor);

        // Downpipes NOT affected by tile
        const dpRate = PRICING.downpipeEach[els.downpipeType.value][storeys];
        add("Downpipes", downpipes * dpRate);

        add("Difficult access allowance", accessAllowance);

        if(twoDay) add("2nd day setup time", PRICING.secondDaySetup);

        if(els.scaffolding.checked){
          let s = PRICING.scaffoldingDefault;
          if(els.difficultScaffolding.checked) s *= PRICING.difficultScaffoldingMultiplier;
          add("Scaffolding", s);
        } else {
          els.difficultScaffolding.checked = false;
        }
        els.difficultScaffolding.disabled = !els.scaffolding.checked;

        if(els.boom.checked){
          add("Boom lift", PRICING.boomTravel + (PRICING.boomPerDay * (twoDay ? 2 : 1)));
        }

        const total = lines.reduce((sum, l)=>sum + l.cost, 0);

        els.topPills.innerHTML = `
          <div class="pill">Total (${excludeGST ? "ex" : "inc"} GST): <strong>${money(total)}</strong></div>
        `;

        els.breakdown.innerHTML = `
          <thead><tr><th>Item</th><th class="right">Price (${excludeGST ? "ex" : "inc"} GST)</th></tr></thead>
          <tbody>
            ${lines.map(l=>`<tr><td>${l.label}</td><td class="right">${money(l.cost)}</td></tr>`).join("")}
            <tr><td><strong>Total</strong></td><td class="right"><strong>${money(total)}</strong></td></tr>
          </tbody>
        `;
      }

      document.querySelectorAll("#app input, #app select").forEach(el=>{
        el.addEventListener("input", calc);
        el.addEventListener("change", calc);
      });

      calc();
    }
  </script>
</body>
</html>
